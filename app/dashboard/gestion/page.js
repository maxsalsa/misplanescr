"use client"; import { useState, useEffect } from "react"; import { useSession } from "next-auth/react"; import { toast } from "sonner"; import { Calendar, Send, CheckCircle, XCircle } from "lucide-react"; export default function GestionPage() { const { data: session } = useSession(); const isAdmin = session?.user?.role === "ADMIN"; const [permits, setPermits] = useState([]); const [reason, setReason] = useState(""); const [desc, setDesc] = useState(""); const [from, setFrom] = useState(""); const [to, setTo] = useState(""); useEffect(() => { loadPermits(); }, []); const loadPermits = () => { const url = isAdmin ? "/api/justifications" : `/api/justifications?userId=${session?.user?.id}`; fetch(url).then(r=>r.json()).then(setPermits); }; const requestPermit = async () => { if(!reason || !from || !to) return toast.error("Complete campos"); const res = await fetch("/api/justifications", { method: "POST", body: JSON.stringify({ userId: session?.user?.id, type: "DOCENTE", reason, description: desc, dateFrom: from, dateTo: to }) }); if(res.ok) { toast.success("Enviado"); loadPermits(); setDesc(""); } }; const updateStatus = async (id, status) => { await fetch("/api/justifications", { method: "PUT", body: JSON.stringify({ id, status }) }); toast.success(status); loadPermits(); }; return ( <div className="p-8 max-w-7xl mx-auto bg-slate-50 min-h-screen"> <h1 className="text-3xl font-black mb-8 text-slate-800">Gestión Administrativa</h1> <div className="grid lg:grid-cols-3 gap-8"> {!isAdmin && ( <div className="bg-white p-6 rounded-2xl shadow-lg border h-fit"> <h3 className="font-bold text-lg mb-4 flex items-center gap-2"><Calendar className="text-blue-600"/> Solicitar Permiso</h3> <div className="space-y-3"> <select className="select select-bordered w-full" value={reason} onChange={e=>setReason(e.target.value)}><option value="">Motivo...</option><option>Cita Médica</option><option>Personales</option></select> <div className="grid grid-cols-2 gap-2"><input type="date" className="input input-bordered" value={from} onChange={e=>setFrom(e.target.value)}/><input type="date" className="input input-bordered" value={to} onChange={e=>setTo(e.target.value)}/></div> <textarea className="textarea textarea-bordered w-full" placeholder="Detalles..." value={desc} onChange={e=>setDesc(e.target.value)}></textarea> <button onClick={requestPermit} className="btn btn-primary w-full gap-2"><Send className="w-4"/> Enviar</button> </div> </div> )} <div className={`bg-white p-6 rounded-2xl shadow-lg border ${!isAdmin ? "lg:col-span-2" : "lg:col-span-3"}`}> <h3 className="font-bold text-lg mb-4">{isAdmin ? "Solicitudes Recibidas" : "Mis Solicitudes"}</h3> <div className="space-y-4"> {permits.map(p => ( <div key={p.id} className="p-4 border rounded-xl flex justify-between items-center bg-slate-50"> <div> <div className="flex items-center gap-2"><span className={`badge ${p.status==="APROBADO"?"badge-success":"badge-warning"} text-white`}>{p.status}</span><span className="font-bold">{p.reason}</span>{isAdmin&&<span className="text-xs bg-slate-200 px-2 rounded">{p.user?.name}</span>}</div> </div> {isAdmin && p.status === "PENDIENTE" && ( <div className="flex gap-2"><button onClick={()=>updateStatus(p.id, "APROBADO")} className="btn btn-sm btn-success"><CheckCircle/></button><button onClick={()=>updateStatus(p.id, "RECHAZADO")} className="btn btn-sm btn-error"><XCircle/></button></div> )} </div> ))} </div> </div> </div> </div> ); }