"use client"; import { useState, useEffect } from "react"; import { useSession } from "next-auth/react"; import { toast } from "sonner"; import { Upload, Star, Brain, Eye, Activity, Info, Edit, X, Save } from "lucide-react"; export default function GroupsPage() { const { data: session } = useSession(); const [groups, setGroups] = useState([]); const [isImportOpen, setIsImportOpen] = useState(false); const [editingStudent, setEditingStudent] = useState(null); const [file, setFile] = useState(null); const [newGroupName, setNewGroupName] = useState(""); useEffect(() => { loadGroups(); }, []); const loadGroups = () => { fetch("/api/groups/list").then(r=>r.json()).then(setGroups); }; const handleImport = async (e) => { e.preventDefault(); const formData = new FormData(); formData.append("file", file); formData.append("userId", session?.user?.id); formData.append("groupName", newGroupName); const res = await fetch("/api/groups/import", { method: "POST", body: formData }); if(res.ok) { toast.success("Grupo Importado"); setIsImportOpen(false); loadGroups(); } }; const saveStudent = async () => { if(!editingStudent) return; const res = await fetch("/api/student", { method: "PUT", body: JSON.stringify(editingStudent) }); if(res.ok) { toast.success("Expediente Actualizado"); setEditingStudent(null); loadGroups(); } else { toast.error("Error al guardar"); } }; const toggleCondition = (cond) => { let current = editingStudent.condition || ""; if (current.includes(cond)) { setEditingStudent({...editingStudent, condition: current.replace(cond, "").trim()}); } else { setEditingStudent({...editingStudent, condition: (current + " " + cond).trim()}); } }; const getIcon = (c) => { if(!c) return null; const C = c.toUpperCase(); if(C.includes("TEA")||C.includes("TDAH")) return <Brain className="w-4 text-purple-500"/>; if(C.includes("VISUAL")) return <Eye className="w-4 text-blue-500"/>; if(C.includes("ALTA")) return <Star className="w-4 text-yellow-500"/>; return <Activity className="w-4 text-red-500"/>; }; return ( <div className="p-8 max-w-7xl mx-auto min-h-screen bg-slate-50"> <div className="flex justify-between items-center mb-8"> <div><h1 className="text-3xl font-black text-slate-800">Gesti√≥n de Matr√≠cula y NEE</h1><p className="text-slate-500">Administraci√≥n de Expedientes Estudiantiles.</p></div> <button onClick={()=>setIsImportOpen(true)} className="btn btn-primary gap-2"><Upload className="w-4"/> Subir Excel</button> </div> <div className="grid gap-6"> {groups.map(g=>( <div key={g.id} className="card bg-white shadow-md border collapse collapse-arrow"> <input type="checkbox"/> <div className="collapse-title text-xl font-bold flex justify-between pr-10"> <span>{g.name} <span className="text-sm font-normal text-slate-400">({g.students.length})</span></span> {g.isGuide && <span className="badge badge-warning text-white">Grupo Gu√≠a</span>} </div> <div className="collapse-content"> <div className="overflow-x-auto"> <table className="table table-xs w-full"> <thead className="bg-slate-50"><tr><th>Nombre</th><th>Correo</th><th>Adecuaci√≥n</th><th>Condici√≥n</th><th>M√©dico</th><th>Acci√≥n</th></tr></thead> <tbody> {g.students.map(s=>( <tr key={s.id} className="hover:bg-blue-50 transition-colors"> <td className="font-bold">{s.apellido1} {s.nombre}</td> <td>{s.correo}</td> <td>{s.adecuacion ? <span className="badge badge-sm">{s.adecuacion}</span> : "-"}</td> <td><div className="flex gap-1 items-center">{getIcon(s.condition)} <span className="text-xs">{s.condition}</span></div></td> <td>{s.medicalNotes && <span className="text-red-500 font-bold text-xs flex gap-1"><Info className="w-3"/> {s.medicalNotes}</span>}</td> <td> <button onClick={()=>setEditingStudent(s)} className="btn btn-xs btn-ghost text-blue-600"><Edit className="w-3"/> Editar</button> </td> </tr> ))} </tbody> </table> </div> </div> </div> ))} </div> {isImportOpen && ( <div className="fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50"> <form onSubmit={handleImport} className="bg-white p-8 rounded-xl shadow-2xl max-w-md w-full space-y-4"> <h3 className="font-bold text-lg">Importar Lista</h3> <input className="input input-bordered w-full" placeholder="Nombre (Ej: 10-1)" onChange={e=>setNewGroupName(e.target.value)} required/> <input type="file" accept=".xlsx" onChange={e=>setFile(e.target.files[0])} className="file-input w-full" required/> <div className="flex gap-2"><button type="button" onClick={()=>setIsImportOpen(false)} className="btn btn-ghost flex-1">Cancelar</button><button type="submit" className="btn btn-primary flex-1">Importar</button></div> </form> </div> )} {editingStudent && ( <div className="fixed inset-0 bg-black/60 flex items-center justify-center p-4 z-50 backdrop-blur-sm"> <div className="bg-white rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden animate-scale-in"> <div className="bg-slate-900 text-white p-4 flex justify-between items-center"> <h3 className="font-bold text-lg flex items-center gap-2"><Info className="w-5"/> Expediente Digital</h3> <button onClick={()=>setEditingStudent(null)} className="btn btn-sm btn-ghost btn-circle text-white"><X className="w-5"/></button> </div> <div className="p-6 space-y-6"> <div className="text-center border-b pb-4"> <h2 className="text-2xl font-black text-slate-800">{editingStudent.nombre} {editingStudent.apellido1}</h2> <p className="text-slate-500 font-mono">{editingStudent.cedula}</p> </div> <div> <label className="text-xs font-bold uppercase text-slate-400 mb-2 block">Correo Oficial (Teams)</label> <input className="input input-bordered w-full" value={editingStudent.correo || ""} onChange={e=>setEditingStudent({...editingStudent, correo: e.target.value})}/> </div> <div> <label className="text-xs font-bold uppercase text-slate-400 mb-2 block">Tipo de Adecuaci√≥n</label> <select className="select select-bordered w-full" value={editingStudent.adecuacion || ""} onChange={e=>setEditingStudent({...editingStudent, adecuacion: e.target.value})}> <option value="">Ninguna</option> <option value="AC">Adecuaci√≥n de Acceso (AC)</option> <option value="NS">No Significativa (NS)</option> <option value="AS">Significativa (AS)</option> </select> </div> <div> <label className="text-xs font-bold uppercase text-slate-400 mb-2 block">Condiciones / Diagn√≥sticos</label> <div className="grid grid-cols-2 gap-2"> <button onClick={()=>toggleCondition("TEA")} className={`btn btn-sm ${editingStudent.condition?.includes("TEA") ? "btn-primary" : "btn-outline"}`}>üß† TEA (Autismo)</button> <button onClick={()=>toggleCondition("TDAH")} className={`btn btn-sm ${editingStudent.condition?.includes("TDAH") ? "btn-primary" : "btn-outline"}`}>‚ö° TDAH</button> <button onClick={()=>toggleCondition("VISUAL")} className={`btn btn-sm ${editingStudent.condition?.includes("VISUAL") ? "btn-info" : "btn-outline"}`}>üëÅÔ∏è Baja Visi√≥n</button> <button onClick={()=>toggleCondition("ALTA DOTACION")} className={`btn btn-sm ${editingStudent.condition?.includes("ALTA") ? "btn-warning" : "btn-outline"}`}>‚≠ê Alta Dotaci√≥n</button> </div> </div> <div> <label className="text-xs font-bold uppercase text-slate-400 mb-2 block">Alerta M√©dica / Observaciones</label> <textarea className="textarea textarea-bordered w-full h-20" placeholder="Alergias, medicamentos, epilepsia..." value={editingStudent.medicalNotes || ""} onChange={e=>setEditingStudent({...editingStudent, medicalNotes: e.target.value})}></textarea> </div> <button onClick={saveStudent} className="btn btn-primary w-full btn-lg shadow-lg gap-2"><Save className="w-5"/> Guardar Cambios</button> </div> </div> </div> )} </div> ); }