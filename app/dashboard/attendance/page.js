"use client"; import { useState, useEffect } from "react"; import { useSession } from "next-auth/react"; import { toast } from "sonner"; import { Check, X, Clock, ShieldCheck, Calendar, Users, Save } from "lucide-react"; export default function AttendancePage() { const { data: session } = useSession(); const [groups, setGroups] = useState([]); const [selectedGroupId, setSelectedGroupId] = useState(""); const [students, setStudents] = useState([]); const [attendance, setAttendance] = useState({}); const [date, setDate] = useState(new Date().toISOString().split("T")[0]); const [loading, setLoading] = useState(false); useEffect(() => { fetch("/api/groups/list").then(r => r.json()).then(setGroups); }, []); useEffect(() => { if (selectedGroupId) { const group = groups.find(g => g.id === selectedGroupId); if (group) { setStudents(group.students); const initial = {}; group.students.forEach(s => initial[s.id] = "PRESENTE"); setAttendance(initial); } } }, [selectedGroupId, groups]); const toggleStatus = (studentId) => { const current = attendance[studentId]; const states = ["PRESENTE", "AUSENTE", "TARDIA", "JUSTIFICADA"]; const nextIndex = (states.indexOf(current) + 1) % states.length; setAttendance(prev => ({ ...prev, [studentId]: states[nextIndex] })); }; const getStatusColor = (status) => { switch(status) { case "PRESENTE": return "bg-green-100 text-green-700 border-green-300"; case "AUSENTE": return "bg-red-100 text-red-700 border-red-300"; case "TARDIA": return "bg-yellow-100 text-yellow-700 border-yellow-300"; case "JUSTIFICADA": return "bg-blue-100 text-blue-700 border-blue-300"; default: return "bg-gray-100"; } }; const saveAttendance = async () => { if (!selectedGroupId) return; setLoading(true); const payload = Object.entries(attendance).map(([sid, status]) => ({ studentId: sid, status })); const res = await fetch("/api/attendance", { method: "POST", body: JSON.stringify({ groupId: selectedGroupId, date, attendanceData: payload }) }); if (res.ok) { toast.success("Asistencia guardada correctamente"); setSelectedGroupId(""); } else { toast.error("Error al guardar"); } setLoading(false); }; return ( <div className="p-8 max-w-6xl mx-auto min-h-screen bg-slate-50"> <h1 className="text-3xl font-black text-slate-800 mb-6 flex items-center gap-2"> <Clock className="text-blue-600"/> Pase de Lista RÃ¡pido </h1> <div className="flex flex-wrap gap-4 mb-8 bg-white p-4 rounded-xl shadow border"> <div className="flex-1 min-w-[200px]"> <label className="label font-bold text-xs uppercase text-slate-400">Seleccionar Grupo</label> <select className="select select-bordered w-full" value={selectedGroupId} onChange={e=>setSelectedGroupId(e.target.value)}> <option value="">-- Seleccione --</option> {groups.map(g => <option key={g.id} value={g.id}>{g.name}</option>)} </select> </div> <div> <label className="label font-bold text-xs uppercase text-slate-400">Fecha</label> <input type="date" className="input input-bordered" value={date} onChange={e=>setDate(e.target.value)} /> </div> </div> {selectedGroupId && ( <div className="animate-fade-in"> <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 mb-8"> {students.map(student => ( <div key={student.id} onClick={() => toggleStatus(student.id)} className={`cursor-pointer p-4 rounded-xl border-2 transition-all shadow-sm hover:scale-[1.02] select-none ${getStatusColor(attendance[student.id])}`} > <div className="flex justify-between items-start"> <div> <p className="font-bold text-sm">{student.apellido1} {student.apellido2}</p> <p className="text-xs">{student.nombre}</p> </div> <div className="font-black text-xs px-2 py-1 bg-white/50 rounded uppercase"> {attendance[student.id]} </div> </div> </div> ))} </div> <div className="fixed bottom-8 right-8 z-20"> <button onClick={saveAttendance} disabled={loading} className="btn btn-primary btn-lg shadow-2xl rounded-full px-8 animate-bounce"> {loading ? "Guardando..." : <><Save className="w-5 h-5"/> GUARDAR LISTA</>} </button> </div> </div> )} </div> ); }