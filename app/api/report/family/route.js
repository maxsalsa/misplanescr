import { prisma } from "@/lib/db"; import { NextResponse } from "next/server"; export async function GET(req) { const { searchParams } = new URL(req.url); const studentId = searchParams.get("studentId"); try { const student = await prisma.student.findUnique({ where: { id: studentId }, include: { conductIncidents: true, attendance: { include: { record: true } }, group: true } }); const totalIncidents = student.conductIncidents.length; const conductGrade = Math.max(0, 100 - student.conductIncidents.reduce((a, b) => a + b.pointsDeducted, 0)); const absences = student.attendance.filter(a => a.status === "AUSENTE").length; return NextResponse.json({ student, stats: { totalIncidents, conductGrade, absences } }); } catch (e) { return NextResponse.json({ error: "Error" }, { status: 500 }); } }