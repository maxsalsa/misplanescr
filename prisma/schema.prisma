generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id                 String   @id @default(uuid())
  email              String   @unique
  name               String?
  role               String   @default("DOCENTE") 
  instituciones      String?  @default("[]") 
  institucionActiva  String?  

  grupos             Grupo[]
  permisos           PermisoDocente[]
  incidenciasReportadas Incidencia[] @relation("ReportadoPor")
  recursosPublicados RecursoCompartido[] // Lo que el profe comparte
}

model Grupo {
  id        String   @id @default(uuid())
  nombre    String   
  materia   String   @default("General") 
  docenteId String
  docente   User     @relation(fields: [docenteId], references: [id])
  estudiantes Estudiante[]
  clases    Clase[]  
  recursos  RecursoCompartido[]
}

model Estudiante {
  id               String   @id @default(uuid())
  nombre           String
  cedula           String?  @unique
  
  // LLAVE DE ACCESO FAMILIAR
  codigoAcceso     String   @default(cuid()) // PIN ÚNICO AUTOMÁTICO
  
  tipoAdecuacion   String   @default("NINGUNA") 
  condicion        String?  
  notasImportantes String?

  grupoId          String
  grupo            Grupo    @relation(fields: [grupoId], references: [id])
  
  asistencias      Asistencia[]
  boletas          Incidencia[]
}

// NUEVO: LA MOCHILA DIGITAL
model RecursoCompartido {
  id          String   @id @default(uuid())
  fecha       DateTime @default(now())
  titulo      String   // Ej: "Guía de Estudio: Célula"
  tipo        String   // RESUMEN, TAREA, AVISO
  contenido   String   // Texto o Link
  
  grupoId     String
  grupo       Grupo    @relation(fields: [grupoId], references: [id])
  
  docenteId   String
  docente     User     @relation(fields: [docenteId], references: [id])
}

// (Modelos existentes: Clase, Asistencia, Incidencia, PermisoDocente...)
model Clase {
  id        String   @id @default(uuid())
  fecha     DateTime @default(now())
  lecciones Int      @default(2) 
  tema      String?
  grupoId   String
  grupo     Grupo    @relation(fields: [grupoId], references: [id])
  registros Asistencia[]
}

model Asistencia {
  id           String   @id @default(uuid())
  estado       String   
  claseId      String
  clase        Clase    @relation(fields: [claseId], references: [id])
  estudianteId String
  estudiante   Estudiante @relation(fields: [estudianteId], references: [id])
}

model Incidencia {
  id           String   @id @default(uuid())
  fecha        DateTime @default(now())
  tipo         String   @default("LEVE") 
  puntos       Int      @default(0)      
  descripcion  String
  articuloREA  String?
  accionTomada String?
  estudianteId String
  estudiante   Estudiante @relation(fields: [estudianteId], references: [id])
  reportadoPorId String? 
  reportadoPor   User?   @relation("ReportadoPor", fields: [reportadoPorId], references: [id])
}

model PermisoDocente {
  id          String   @id @default(uuid())
  fecha       DateTime @default(now())
  tipo        String   
  estado      String   
  detalle     String
  docenteId   String
  docente     User     @relation(fields: [docenteId], references: [id])
}

model Syllabus {
  id        String @id @default(uuid())
  modalidad String 
  level     String 
  subject   String 
  unit      String
  topic     String 
  period    String
}